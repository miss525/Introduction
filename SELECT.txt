SELECT 
RTRIM(US.FIRST_NAME + ' ' + ISNULL(US.MIDDLE_INITIAL, '')) + ' ' + US.LAST_NAME AS Changer,  
HD.ARTIFACT_HISTORY_ID AS AH_ID, 
HD.CHANGESET_ID AS CH_ID, 
HC.ARTIFACT_ID AS RiskID, 
RK.NAME AS RiskName, 



---============vitom rame gavakete==============-
HD.FIELD_CAPTION,
CASE WHEN LEFT(HD.FIELD_CAPTION, 1) = 'I' THEN 'Impact'  ELSE NULL END AS Impact,
CASE WHEN LEFT(HD.FIELD_CAPTION, 1) = 'P' THEN 'Probability'  ELSE NULL END AS Probability,




--RPB.NAME AS Probability, 
RPB.SCORE * RIM.SCORE AS Exposure, 
--dbo.TST_RISK_STATUS.NAME AS Status, 
--dbo.TST_RISK_TYPE.NAME AS Type, 
--dbo.TST_RELEASE.VERSION_NUMBER AS Release, 
--CMP.NAME AS COMPONENT_NAME, 
--RK.CREATION_DATE, 
--RK.LAST_UPDATE_DATE, 
--RK.REVIEW_DATE, 
--RK.CLOSED_DATE, 
RTRIM(US.FIRST_NAME + ' ' + ISNULL(US.MIDDLE_INITIAL, '')) + ' ' + US.LAST_NAME AS CREATOR_NAME, 
--ACP.CUST_01, 
--ACP.CUST_02,


--HD.FIELD_CAPTION AS Field, 
HD.OLD_VALUE AS Old, 
HD.NEW_VALUE AS New, 
HD.CUSTOM_PROPERTY_ID,
--HC.ARTIFACT_TYPE_ID AS ArtifactType, 
HC.CHANGE_DATE AS ChangeDate
--HT.CHANGE_NAME AS Change


FROM            dbo.TST_HISTORY_DETAIL AS HD INNER JOIN
                         dbo.TST_HISTORY_CHANGESET AS HC ON HD.CHANGESET_ID = HC.CHANGESET_ID INNER JOIN
                         dbo.TST_RISK AS RK ON HC.ARTIFACT_ID = RK.RISK_ID INNER JOIN
                         dbo.TST_USER_PROFILE AS US ON HC.USER_ID = US.USER_ID INNER JOIN
                         dbo.TST_HISTORY_CHANGESET_TYPE AS HT ON HC.CHANGETYPE_ID = HT.CHANGETYPE_ID LEFT OUTER JOIN
                         dbo.TST_ARTIFACT_FIELD AS AF ON HD.FIELD_ID = AF.ARTIFACT_FIELD_ID INNER JOIN
						

						dbo.TST_RISK_IMPACT AS RIM ON RK.RISK_IMPACT_ID = RIM.RISK_IMPACT_ID INNER JOIN
                         dbo.TST_RISK_PROBABILITY AS RPB ON RK.RISK_PROBABILITY_ID = RPB.RISK_PROBABILITY_ID INNER JOIN
                         --dbo.TST_RISK_STATUS ON RK.RISK_STATUS_ID = dbo.TST_RISK_STATUS.RISK_STATUS_ID INNER JOIN
                        -- dbo.TST_RISK_TYPE ON RK.RISK_TYPE_ID = dbo.TST_RISK_TYPE.RISK_TYPE_ID INNER JOIN
                       dbo.TST_RELEASE ON RK.RELEASE_ID = dbo.TST_RELEASE.RELEASE_ID LEFT OUTER JOIN
                       --  dbo.TST_COMPONENT AS CMP ON RK.COMPONENT_ID = CMP.COMPONENT_ID LEFT OUTER JOIN
                             (SELECT        ARTIFACT_ID, ARTIFACT_TYPE_ID, PROJECT_ID, CUST_01, CUST_02
                               FROM            dbo.TST_ARTIFACT_CUSTOM_PROPERTY
                               WHERE        (ARTIFACT_TYPE_ID = 14)) AS ACP ON RK.RISK_ID = ACP.ARTIFACT_ID INNER JOIN
                         dbo.TST_USER_PROFILE AS US1 ON RK.CREATOR_ID = US1.USER_ID 
						--INNER JOIN dbo.TST_HISTORY_POSITION AS HP ON HP.CHANGESET_ID = HD.CHANGESET_ID


WHERE        (HC.ARTIFACT_TYPE_ID = 14 AND RK.RISK_ID = 13)